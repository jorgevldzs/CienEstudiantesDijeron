@page "/tablero"

@layout Layout.LayoutSinNav

@inject JuegoService Juego
@implements IDisposable
@rendermode InteractiveServer

<PageTitle>Tablero</PageTitle>

<div class="marcador-container" style="display: flex; justify-content: space-around; background: #222; color: white; padding: 20px;">
    <div class="equipo">
        <h2 style="color: cyan;">@Juego.Equipo1</h2>
        <h5>Puntos: @Juego.puntosEquipo1</h5>
    </div>
    <div class="vs">
        <h1>VS</h1>
        <h4 style="text-align: center; font-size: 2.5rem; color: gold;">@Juego.puntosPartida</h4>
        
        @if (Juego.Multiplicador > 1)
        {
            <div style="background: red; color: white; padding: 5px; border-radius: 5px; animation: pulse 1s infinite;">
                ¡RONDA @Juego.Multiplicador X!
            </div>
        }
    </div>
    <div class="equipo">
        <h2 style="color: magenta;">@Juego.Equipo2</h2>
        <h5>Puntos: @Juego.puntosEquipo2</h5>
    </div>
</div>

<div style="background-color: navy; color: white; min-height: 400px; padding: 50px; text-align: center;">
    
    @if (Juego.PreguntaRevelada)
    {


        <h1 style="font-size: 3rem; margin-bottom: 30px; text-transform: uppercase;">@Juego.PreguntaActual</h1>

        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 900px; margin: 0 auto;">
            @for (int i = 0; i < Juego.RespuestasActuales.Count; i++)
            {
                var res = Juego.RespuestasActuales[i];
                var estaRevelada = Juego.RespuestasReveladas.Contains(res.res_respuesta);

                <div style="height: 60px; border: 2px solid white; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: @(estaRevelada ? "gold" : "#333"); color: @(estaRevelada ? "black" : "white"); font-size: 1.5rem; font-weight: bold;">
                    <span>@(i + 1). @(estaRevelada ? res.res_respuesta : "???")</span>
                    @if (estaRevelada)
                    {
                        @* Mostramos el valor multiplicado directamente *@
                        <span style="border-left: 2px solid black; padding-left: 15px;">
                            @Juego.ObtenerPuntosMultiplicados(res.res_cantidad)
                        </span>
                    }
                </div>
            }
        </div>
    }
    else
    {
        <h1 style="color: rgba(255,255,255,0.3); margin-top: 100px;">ESPERANDO RONDA...</h1>
    }
</div>

@if (Juego.PartidaTerminada)
{
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,50,0.95); z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;">
        <h1 style="font-size: 5rem; color: gold; text-shadow: 2px 2px 10px white;">¡FIN DE LA PARTIDA!</h1>
        
        <div style="display: flex; gap: 50px; margin: 40px 0;">
            <div style="text-align: center; border: 3px solid cyan; padding: 20px; border-radius: 15px;">
                <h2 style="font-size: 3rem;">@Juego.Equipo1</h2>
                <p style="font-size: 4rem;">@Juego.puntosEquipo1</p>
            </div>
            <h1 style="font-size: 5rem; align-self: center;">VS</h1>
            <div style="text-align: center; border: 3px solid magenta; padding: 20px; border-radius: 15px;">
                <h2 style="font-size: 3rem;">@Juego.Equipo2</h2>
                <p style="font-size: 4rem;">@Juego.puntosEquipo2</p>
            </div>
        </div>

        <h1 style="font-size: 4rem; background: gold; color: black; padding: 10px 40px; border-radius: 50px; animation: pulse 1s infinite;">
            GANADOR: @(Juego.puntosEquipo1 > Juego.puntosEquipo2 ? Juego.Equipo1 : (Juego.puntosEquipo2 > Juego.puntosEquipo1 ? Juego.Equipo2 : "¡EMPATE!"))
        </h1>
    </div>
}

@* Añade este estilo CSS al final de tu archivo para que el aviso brille *@
<style>
    @@keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
</style>

@code {
    protected override void OnInitialized()
    {
        Juego.OnChange += ActualizarUI;
    }

    private async void ActualizarUI()
    {
        await InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        Juego.OnChange -= ActualizarUI;
    }
}